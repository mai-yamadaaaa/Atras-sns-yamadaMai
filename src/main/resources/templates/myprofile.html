<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>Insert title here</title>
</head>

<body>

	<form th:action="@{/mypage/profile}" method="post" enctype="multipart/form-data">
		<label>ユーザー名</label>
		<input type="text" name="name" th:value="${user.username}">
		<label>メールアドレス</label>
		<input type="text" name="email" th:value="${user.email}">
		<label>パスワード</label>
		<input type="password" name="password" th:value="${user.password}">
		<label>パスワード確認</label>
		<input type="password" name="confirmPass" th:value="${user.password}">
		<label>自己紹介</label>
		<textarea  name="bio" th:text="${user.bio}"></textarea>
		<label>アイコン画像</label><span th:text="${imageMessage}"></span>
		<input
		  type="file"
		  id="image"
		  name="image"
		  accept="image/*"
		  enc
		/>
		<div>
		  <img
		    id="preview"
		    th:if="${user.images}"
		    th:src="@{'/images/icon/' + ${user.images}}"
		    alt="プレビュー画像"
		    class="hidden mx-auto max-w-[200px] max-h-[200px] rounded-md border"
		  />
		</div>
		
		<button>更新</button>
	</form>
	<script>
	  const imageFile = document.getElementById("image");
	  const preview = document.getElementById("preview");
	  const originalSrc = preview ? preview.src : "";

	  if (preview && originalSrc) {
	    preview.classList.remove("hidden");
	  }

	  imageFile.addEventListener("change", function (e) {
	    const file = e.target.files[0];
	    if (file) {
	      const reader = new FileReader();
	      reader.onload = function (e) {
	        preview.src = e.target.result;
	        preview.classList.remove("hidden");
	      };
	      reader.readAsDataURL(file);
	    } else {
	      preview.src = originalSrc;
	      if (!originalSrc) {
	        preview.classList.add("hidden");
	      }
	    }
	  });
	</script>
</body>

</html>